<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - E-Commerce Store</title>
  <style>
    /* ============================================
       CSS VARIABLES - LIGHT & DARK MODE THEMING
       ============================================ */
    :root {
      --bg-primary: #f0f2f5;
      --bg-secondary: #ffffff;
      --bg-tertiary: #e4e6eb;
      --text-primary: #1c1e21;
      --text-secondary: #606770;
      --text-muted: #8a8d91;
      --accent-color: #0074d9;
      --accent-hover: #0063b8;
      --danger-color: #dc3545;
      --danger-hover: #c82333;
      --success-color: #28a745;
      --success-hover: #218838;
      --warning-color: #ffc107;
      --warning-hover: #e0a800;
      --border-color: #dddfe2;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --overlay-bg: rgba(0, 0, 0, 0.5);
      --input-bg: #f5f6f7;
      --table-stripe: #f8f9fa;
      --sidebar-bg: #2c3e50;
      --sidebar-text: #ecf0f1;
      --sidebar-hover: #34495e;
      --sidebar-active: #3498db;
      --transition: all 0.3s ease;
    }

    /* Dark Mode Variables */
    body.dark-mode {
      --bg-primary: #18191a;
      --bg-secondary: #242526;
      --bg-tertiary: #3a3b3c;
      --text-primary: #e4e6eb;
      --text-secondary: #b0b3b8;
      --text-muted: #8a8d91;
      --accent-color: #4da6ff;
      --accent-hover: #3d8ad9;
      --border-color: #3e4042;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --input-bg: #3a3b3c;
      --table-stripe: #2d2e2f;
      --sidebar-bg: #1a1a2e;
      --sidebar-hover: #16213e;
      --sidebar-active: #4da6ff;
    }

    /* ============================================
       BASE STYLES & RESET
       ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      transition: var(--transition);
      min-height: 100vh;
    }

    /* ============================================
       LOGIN PAGE STYLES
       ============================================ */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, var(--sidebar-bg) 0%, var(--accent-color) 100%);
    }

    .login-box {
      background: var(--bg-secondary);
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 40px var(--shadow-color);
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .login-box h1 {
      margin-bottom: 10px;
      color: var(--text-primary);
      font-size: 28px;
    }

    .login-box .subtitle {
      color: var(--text-secondary);
      margin-bottom: 30px;
      font-size: 14px;
    }

    .login-box .admin-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 15px;
      background: var(--input-bg);
      color: var(--text-primary);
      transition: var(--transition);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 116, 217, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .error-message {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger-color);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--accent-color);
      color: white;
      width: 100%;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
    }

    .btn-success {
      background: var(--success-color);
      color: white;
    }

    .btn-success:hover {
      background: var(--success-hover);
    }

    .btn-danger {
      background: var(--danger-color);
      color: white;
    }

    .btn-danger:hover {
      background: var(--danger-hover);
    }

    .btn-warning {
      background: var(--warning-color);
      color: #000;
    }

    .btn-warning:hover {
      background: var(--warning-hover);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background: var(--border-color);
    }

    .btn-sm {
      padding: 8px 12px;
      font-size: 13px;
    }

    /* ============================================
       ADMIN DASHBOARD LAYOUT
       ============================================ */
    .admin-container {
      display: none;
      min-height: 100vh;
    }

    .admin-container.active {
      display: flex;
    }

    /* Sidebar Navigation */
    .sidebar {
      width: 260px;
      background: var(--sidebar-bg);
      color: var(--sidebar-text);
      padding: 20px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      transition: var(--transition);
      z-index: 100;
    }

    .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }

    .sidebar-header h2 {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
    }

    .sidebar-header .admin-badge {
      background: var(--accent-color);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }

    .nav-menu {
      list-style: none;
    }

    .nav-item {
      margin: 4px 10px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      color: var(--sidebar-text);
      text-decoration: none;
      border-radius: 8px;
      transition: var(--transition);
      cursor: pointer;
    }

    .nav-link:hover {
      background: var(--sidebar-hover);
    }

    .nav-link.active {
      background: var(--sidebar-active);
      color: white;
    }

    .nav-link .icon {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    .sidebar-footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logout-btn {
      width: 100%;
      background: rgba(220, 53, 69, 0.2);
      color: #ff6b6b;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: var(--transition);
    }

    .logout-btn:hover {
      background: var(--danger-color);
      color: white;
    }

    /* Main Content Area */
    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 20px 30px;
      transition: var(--transition);
    }

    /* Top Header Bar */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
    }

    .top-bar h1 {
      font-size: 24px;
      color: var(--text-primary);
    }

    .top-bar-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .theme-toggle {
      background: var(--bg-tertiary);
      border: none;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      transition: var(--transition);
    }

    .theme-toggle:hover {
      background: var(--border-color);
      transform: rotate(20deg);
    }

    .store-link {
      text-decoration: none;
      color: var(--accent-color);
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
    }

    .store-link:hover {
      text-decoration: underline;
    }

    /* Dashboard Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--bg-secondary);
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 8px var(--shadow-color);
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px var(--shadow-color);
    }

    .stat-card .icon {
      font-size: 32px;
      margin-bottom: 12px;
    }

    .stat-card .value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .stat-card .label {
      color: var(--text-secondary);
      font-size: 14px;
      margin-top: 4px;
    }

    /* Content Sections */
    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }

    .section-card {
      background: var(--bg-secondary);
      border-radius: 12px;
      box-shadow: 0 2px 8px var(--shadow-color);
      margin-bottom: 20px;
      overflow: hidden;
    }

    .section-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .section-header h2 {
      font-size: 18px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-body {
      padding: 24px;
    }

    /* Product Form */
    .product-form {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .product-form .full-width {
      grid-column: 1 / -1;
    }

    .form-actions {
      grid-column: 1 / -1;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding-top: 10px;
      border-top: 1px solid var(--border-color);
      margin-top: 10px;
    }

    /* Product Table */
    .table-container {
      overflow-x: auto;
    }

    .product-table {
      width: 100%;
      border-collapse: collapse;
    }

    .product-table th,
    .product-table td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .product-table th {
      background: var(--bg-tertiary);
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .product-table tbody tr {
      transition: var(--transition);
    }

    .product-table tbody tr:hover {
      background: var(--table-stripe);
    }

    .product-table tbody tr:nth-child(even) {
      background: var(--table-stripe);
    }

    .product-table tbody tr:nth-child(even):hover {
      background: var(--bg-tertiary);
    }

    .product-icon {
      font-size: 24px;
    }

    .product-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    .product-category {
      display: inline-block;
      padding: 4px 10px;
      background: var(--bg-tertiary);
      border-radius: 20px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .product-price {
      font-weight: 600;
      color: var(--success-color);
    }

    .stock-badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .stock-badge.in-stock {
      background: rgba(40, 167, 69, 0.1);
      color: var(--success-color);
    }

    .stock-badge.low-stock {
      background: rgba(255, 193, 7, 0.1);
      color: var(--warning-color);
    }

    .stock-badge.out-of-stock {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger-color);
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: var(--transition);
    }

    .edit-btn {
      background: rgba(0, 116, 217, 0.1);
      color: var(--accent-color);
    }

    .edit-btn:hover {
      background: var(--accent-color);
      color: white;
    }

    .delete-btn {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger-color);
    }

    .delete-btn:hover {
      background: var(--danger-color);
      color: white;
    }

    /* Stock Management */
    .stock-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stock-input {
      width: 70px;
      padding: 6px 10px;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      background: var(--input-bg);
      color: var(--text-primary);
    }

    .stock-btn {
      width: 28px;
      height: 28px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: var(--transition);
    }

    .stock-btn.decrease {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger-color);
    }

    .stock-btn.decrease:hover {
      background: var(--danger-color);
      color: white;
    }

    .stock-btn.increase {
      background: rgba(40, 167, 69, 0.1);
      color: var(--success-color);
    }

    .stock-btn.increase:hover {
      background: var(--success-color);
      color: white;
    }

    /* Search and Filter */
    .table-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 15px;
      flex-wrap: wrap;
    }

    .search-box {
      position: relative;
      flex: 1;
      max-width: 300px;
    }

    .search-box input {
      width: 100%;
      padding: 10px 16px 10px 40px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      background: var(--input-bg);
      color: var(--text-primary);
      transition: var(--transition);
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .search-box::before {
      content: "üîç";
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 16px;
    }

    .filter-select {
      padding: 10px 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      background: var(--input-bg);
      color: var(--text-primary);
      cursor: pointer;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--overlay-bg);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-secondary);
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px var(--shadow-color);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 18px;
      color: var(--text-primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-secondary);
      transition: var(--transition);
    }

    .modal-close:hover {
      color: var(--danger-color);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Confirmation Modal */
    .confirm-modal .modal-body {
      text-align: center;
    }

    .confirm-modal .warning-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .confirm-modal p {
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .confirm-modal .product-name {
      color: var(--text-primary);
      font-size: 18px;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1100;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      padding: 14px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: slideIn 0.3s ease;
      box-shadow: 0 4px 12px var(--shadow-color);
    }

    .toast.success {
      background: var(--success-color);
    }

    .toast.error {
      background: var(--danger-color);
    }

    .toast.warning {
      background: var(--warning-color);
      color: #000;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state .icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state h3 {
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    /* Mobile Menu Toggle */
    .mobile-menu-toggle {
      display: none;
      background: var(--accent-color);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 101;
    }

    /* ============================================
       RESPONSIVE STYLES
       ============================================ */
    @media (max-width: 900px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .product-form {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      .main-content {
        padding: 15px;
        padding-top: 70px;
      }

      .top-bar {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }

      .top-bar h1 {
        font-size: 20px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .table-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .search-box {
        max-width: none;
      }

      .product-table th,
      .product-table td {
        padding: 10px 8px;
        font-size: 13px;
      }

      .action-buttons {
        flex-direction: column;
        gap: 4px;
      }

      .login-box {
        padding: 30px 20px;
      }
    }

    /* Hide certain columns on mobile */
    @media (max-width: 768px) {
      .hide-mobile {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- ============================================
       LOGIN PAGE
       ============================================ -->
  <div id="loginPage" class="login-container">
    <div class="login-box">
      <div class="admin-icon">üîê</div>
      <h1>Admin Panel</h1>
      <p class="subtitle">Enter your credentials to access the dashboard</p>

      <div id="loginError" class="error-message">
        Invalid username or password. Please try again.
      </div>

      <form id="loginForm">
        <div class="form-group">
          <label for="username">Username</label>
          <input
            type="text"
            id="username"
            placeholder="Enter username"
            autocomplete="username"
            required
          >
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            placeholder="Enter password"
            autocomplete="current-password"
            required
          >
        </div>

        <button type="submit" class="btn btn-primary">
          <span>üîì</span> Login to Dashboard
        </button>
      </form>

      <p style="margin-top: 20px; font-size: 12px; color: var(--text-muted);">
        Demo: admin / admin123
      </p>
    </div>
  </div>

  <!-- ============================================
       ADMIN DASHBOARD
       ============================================ -->
  <div id="adminDashboard" class="admin-container">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">‚ò∞</button>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2>
          <span>üõí</span> Store Admin
          <span class="admin-badge">PRO</span>
        </h2>
      </div>

      <nav>
        <ul class="nav-menu">
          <li class="nav-item">
            <a class="nav-link active" data-section="dashboard">
              <span class="icon">üìä</span>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-section="products">
              <span class="icon">üì¶</span>
              <span>Products</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-section="add-product">
              <span class="icon">‚ûï</span>
              <span>Add Product</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-section="stock">
              <span class="icon">üìà</span>
              <span>Stock Management</span>
            </a>
          </li>
        </ul>
      </nav>

      <div class="sidebar-footer">
        <button class="logout-btn" id="logoutBtn">
          <span>üö™</span> Logout
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Bar -->
      <div class="top-bar">
        <h1 id="pageTitle">Dashboard Overview</h1>
        <div class="top-bar-actions">
          <a href="index.html" class="store-link">
            <span>üè™</span> View Store
          </a>
          <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
            üåô
          </button>
        </div>
      </div>

      <!-- Dashboard Section -->
      <section id="dashboard" class="content-section active">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="icon">üì¶</div>
            <div class="value" id="totalProducts">0</div>
            <div class="label">Total Products</div>
          </div>
          <div class="stat-card">
            <div class="icon">üìÇ</div>
            <div class="value" id="totalCategories">0</div>
            <div class="label">Categories</div>
          </div>
          <div class="stat-card">
            <div class="icon">üìä</div>
            <div class="value" id="totalStock">0</div>
            <div class="label">Total Stock</div>
          </div>
          <div class="stat-card">
            <div class="icon">‚ö†Ô∏è</div>
            <div class="value" id="lowStockCount">0</div>
            <div class="label">Low Stock Items</div>
          </div>
        </div>

        <div class="section-card">
          <div class="section-header">
            <h2><span>‚è±Ô∏è</span> Recent Activity</h2>
          </div>
          <div class="section-body">
            <div id="recentActivity" class="empty-state">
              <div class="icon">üìã</div>
              <h3>No Recent Activity</h3>
              <p>Product changes will appear here</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Products Section -->
      <section id="products" class="content-section">
        <div class="section-card">
          <div class="section-header">
            <h2><span>üì¶</span> All Products</h2>
            <button class="btn btn-primary btn-sm" onclick="showSection('add-product')">
              <span>‚ûï</span> Add New
            </button>
          </div>
          <div class="section-body">
            <div class="table-controls">
              <div class="search-box">
                <input
                  type="text"
                  id="productSearch"
                  placeholder="Search products..."
                  onkeyup="filterProducts()"
                >
              </div>
              <select class="filter-select" id="categoryFilter" onchange="filterProducts()">
                <option value="">All Categories</option>
              </select>
            </div>

            <div class="table-container">
              <table class="product-table">
                <thead>
                  <tr>
                    <th>Icon</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="productTableBody">
                  <!-- Products will be rendered here -->
                </tbody>
              </table>
            </div>

            <div id="noProductsMessage" class="empty-state" style="display: none;">
              <div class="icon">üì¶</div>
              <h3>No Products Found</h3>
              <p>Try adjusting your search or add a new product</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Add/Edit Product Section -->
      <section id="add-product" class="content-section">
        <div class="section-card">
          <div class="section-header">
            <h2 id="formTitle"><span>‚ûï</span> Add New Product</h2>
          </div>
          <div class="section-body">
            <form id="productForm" class="product-form">
              <input type="hidden" id="productId">

              <div class="form-group">
                <label for="productName">Product Name *</label>
                <input
                  type="text"
                  id="productName"
                  placeholder="Enter product name"
                  required
                >
              </div>

              <div class="form-group">
                <label for="productPrice">Price (‚Çπ) *</label>
                <input
                  type="number"
                  id="productPrice"
                  placeholder="Enter price"
                  min="1"
                  step="0.01"
                  required
                >
              </div>

              <div class="form-group">
                <label for="productCategory">Category *</label>
                <select id="productCategory" required>
                  <option value="">Select Category</option>
                  <option value="Pen">Pen</option>
                  <option value="Pencil">Pencil</option>
                  <option value="Notebook">Notebook</option>
                  <option value="Sharpener">Sharpener</option>
                  <option value="Eraser">Eraser</option>
                </select>
              </div>

              <div class="form-group">
                <label for="productStock">Stock Quantity *</label>
                <input
                  type="number"
                  id="productStock"
                  placeholder="Enter stock quantity"
                  min="0"
                  required
                >
              </div>

              <div class="form-group">
                <label for="productIcon">Product Icon</label>
                <select id="productIcon">
                  <option value="üñäÔ∏è">üñäÔ∏è Pen</option>
                  <option value="‚úèÔ∏è">‚úèÔ∏è Pencil</option>
                  <option value="üìì">üìì Notebook</option>
                  <option value="üî™">üî™ Sharpener</option>
                  <option value="üßΩ">üßΩ Eraser</option>
                  <option value="üì¶">üì¶ Other</option>
                </select>
              </div>

              <div class="form-group">
                <label for="productImage">Image URL (optional)</label>
                <input
                  type="url"
                  id="productImage"
                  placeholder="https://example.com/image.jpg"
                >
              </div>

              <div class="form-group full-width">
                <label for="productDescription">Description *</label>
                <textarea
                  id="productDescription"
                  placeholder="Enter product description"
                  required
                ></textarea>
              </div>

              <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="resetForm()">
                  Cancel
                </button>
                <button type="submit" class="btn btn-success" id="submitBtn">
                  <span>üíæ</span> Save Product
                </button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- Stock Management Section -->
      <section id="stock" class="content-section">
        <div class="section-card">
          <div class="section-header">
            <h2><span>üìà</span> Stock Management</h2>
          </div>
          <div class="section-body">
            <div class="table-controls">
              <div class="search-box">
                <input
                  type="text"
                  id="stockSearch"
                  placeholder="Search products..."
                  onkeyup="filterStockTable()"
                >
              </div>
              <select class="filter-select" id="stockFilter" onchange="filterStockTable()">
                <option value="">All Stock Levels</option>
                <option value="out">Out of Stock</option>
                <option value="low">Low Stock (1-5)</option>
                <option value="normal">Normal Stock (6+)</option>
              </select>
            </div>

            <div class="table-container">
              <table class="product-table">
                <thead>
                  <tr>
                    <th>Icon</th>
                    <th>Product Name</th>
                    <th>Category</th>
                    <th>Current Stock</th>
                    <th>Update Stock</th>
                  </tr>
                </thead>
                <tbody id="stockTableBody">
                  <!-- Stock items will be rendered here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal confirm-modal">
      <div class="modal-header">
        <h3>Confirm Delete</h3>
        <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <p>Are you sure you want to delete this product?</p>
        <p class="product-name" id="deleteProductName"></p>
        <p style="color: var(--danger-color); font-size: 13px; margin-top: 10px;">
          This action cannot be undone.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" id="confirmDeleteBtn">
          <span>üóëÔ∏è</span> Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    /* ============================================
       ADMIN AUTHENTICATION
       ============================================ */

    // Hardcoded admin credentials (demo only)
    const ADMIN_CREDENTIALS = {
      username: 'admin',
      password: 'admin123'
    };

    // Check if admin is already logged in
    function checkAuthStatus() {
      const isLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
      if (isLoggedIn) {
        showDashboard();
      }
    }

    // Handle login form submission
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        // Login successful
        sessionStorage.setItem('adminLoggedIn', 'true');
        document.getElementById('loginError').classList.remove('show');
        showDashboard();
        showToast('Welcome back, Admin!', 'success');
      } else {
        // Login failed
        document.getElementById('loginError').classList.add('show');
        document.getElementById('password').value = '';
      }
    });

    // Handle logout
    document.getElementById('logoutBtn').addEventListener('click', function() {
      sessionStorage.removeItem('adminLoggedIn');
      document.getElementById('loginPage').style.display = 'flex';
      document.getElementById('adminDashboard').classList.remove('active');
      document.getElementById('loginForm').reset();
      showToast('Logged out successfully', 'success');
    });

    // Show admin dashboard
    function showDashboard() {
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('adminDashboard').classList.add('active');
      initializeDashboard();
    }

    /* ============================================
       DARK MODE TOGGLE
       ============================================ */

    function initDarkMode() {
      const savedTheme = localStorage.getItem('themeMode') || 'light';
      const themeToggle = document.getElementById('themeToggle');

      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        themeToggle.textContent = '‚òÄÔ∏è';
      }

      themeToggle.addEventListener('click', function() {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('themeMode', isDark ? 'dark' : 'light');
        themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      });
    }

    /* ============================================
       SIDEBAR NAVIGATION
       ============================================ */

    // Handle navigation clicks
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', function() {
        const section = this.getAttribute('data-section');
        showSection(section);

        // Close mobile menu
        document.getElementById('sidebar').classList.remove('active');
      });
    });

    // Show specific section
    function showSection(sectionId) {
      // Update nav links
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.toggle('active', link.getAttribute('data-section') === sectionId);
      });

      // Update content sections
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.toggle('active', section.id === sectionId);
      });

      // Update page title
      const titles = {
        'dashboard': 'Dashboard Overview',
        'products': 'Product Management',
        'add-product': 'Add New Product',
        'stock': 'Stock Management'
      };
      document.getElementById('pageTitle').textContent = titles[sectionId] || 'Dashboard';

      // Refresh data if needed
      if (sectionId === 'products') {
        renderProductTable();
      } else if (sectionId === 'stock') {
        renderStockTable();
      } else if (sectionId === 'dashboard') {
        updateDashboardStats();
      }
    }

    // Mobile menu toggle
    document.getElementById('mobileMenuToggle').addEventListener('click', function() {
      document.getElementById('sidebar').classList.toggle('active');
    });

    /* ============================================
       PRODUCT DATA MANAGEMENT
       ============================================ */

    // Default products (matching index.html)
    const defaultProducts = [
      { id: 1, name: "Reynolds", category: "Pen", price: 10, description: "Smooth writing ballpoint pen", icon: "üñäÔ∏è" },
      { id: 2, name: "Cello", category: "Pen", price: 8, description: "Budget-friendly everyday pen", icon: "üñäÔ∏è" },
      { id: 3, name: "Parker", category: "Pen", price: 150, description: "Premium luxury pen", icon: "üñäÔ∏è" },
      { id: 4, name: "Pilot", category: "Pen", price: 25, description: "Japanese quality pen", icon: "üñäÔ∏è" },
      { id: 5, name: "Uniball", category: "Pen", price: 40, description: "Precision gel pen", icon: "üñäÔ∏è" },
      { id: 6, name: "Linc", category: "Pen", price: 5, description: "Affordable writing pen", icon: "üñäÔ∏è" },
      { id: 7, name: "Natraj", category: "Pencil", price: 5, description: "Classic wooden pencil", icon: "‚úèÔ∏è" },
      { id: 8, name: "Apsara", category: "Pencil", price: 6, description: "Popular school pencil", icon: "‚úèÔ∏è" },
      { id: 9, name: "Staedtler", category: "Pencil", price: 15, description: "German quality pencil", icon: "‚úèÔ∏è" },
      { id: 10, name: "Classmate", category: "Notebook", price: 50, description: "Student notebook 200 pages", icon: "üìì" },
      { id: 11, name: "Sundaram", category: "Notebook", price: 40, description: "Ruled notebook", icon: "üìì" },
      { id: 12, name: "Navneet", category: "Notebook", price: 45, description: "Quality writing notebook", icon: "üìì" },
      { id: 13, name: "Natraj", category: "Sharpener", price: 10, description: "Metal blade sharpener", icon: "üî™" },
      { id: 14, name: "Apsara", category: "Sharpener", price: 8, description: "Compact sharpener", icon: "üî™" },
      { id: 15, name: "Faber-Castell", category: "Sharpener", price: 20, description: "Premium sharpener", icon: "üî™" },
      { id: 16, name: "Apsara", category: "Eraser", price: 5, description: "Non-dust eraser", icon: "üßΩ" },
      { id: 17, name: "Natraj", category: "Eraser", price: 4, description: "Soft eraser", icon: "üßΩ" },
      { id: 18, name: "Staedtler", category: "Eraser", price: 15, description: "Precision eraser", icon: "üßΩ" }
    ];

    // Get all products (default + admin-added)
    function getAllProducts() {
      const adminProducts = JSON.parse(localStorage.getItem('adminProducts')) || [];
      return [...defaultProducts, ...adminProducts];
    }

    // Save admin products to localStorage
    function saveAdminProducts(products) {
      localStorage.setItem('adminProducts', JSON.stringify(products));
      syncProductsToFrontend();
    }

    // Get admin-added products only
    function getAdminProducts() {
      return JSON.parse(localStorage.getItem('adminProducts')) || [];
    }

    // Generate unique product ID
    function generateProductId() {
      const allProducts = getAllProducts();
      const maxId = Math.max(0, ...allProducts.map(p => p.id));
      return maxId + 1;
    }

    // Get product stock
    function getProductStock(productId) {
      const stock = JSON.parse(localStorage.getItem('productStock')) || {};
      return stock[productId] !== undefined ? stock[productId] : 10; // Default stock of 10
    }

    // Update product stock
    function updateProductStock(productId, quantity) {
      const stock = JSON.parse(localStorage.getItem('productStock')) || {};
      stock[productId] = Math.max(0, parseInt(quantity));
      localStorage.setItem('productStock', JSON.stringify(stock));
    }

    // Sync products to frontend
    function syncProductsToFrontend() {
      // Store all products for frontend pages to access
      const allProducts = getAllProducts();
      localStorage.setItem('allProductsData', JSON.stringify(allProducts));

      // Log activity
      logActivity('Products synced to store');
    }

    /* ============================================
       PRODUCT FORM HANDLING
       ============================================ */

    // Handle product form submission
    document.getElementById('productForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const productId = document.getElementById('productId').value;
      const productData = {
        name: document.getElementById('productName').value.trim(),
        price: parseFloat(document.getElementById('productPrice').value),
        category: document.getElementById('productCategory').value,
        stock: parseInt(document.getElementById('productStock').value),
        icon: document.getElementById('productIcon').value,
        image: document.getElementById('productImage').value.trim() || null,
        description: document.getElementById('productDescription').value.trim()
      };

      // Validate inputs
      if (!validateProductData(productData)) {
        return;
      }

      if (productId) {
        // Update existing product
        updateProduct(parseInt(productId), productData);
      } else {
        // Add new product
        addProduct(productData);
      }
    });

    // Validate product data
    function validateProductData(data) {
      if (!data.name || data.name.length < 2) {
        showToast('Product name must be at least 2 characters', 'error');
        return false;
      }
      if (data.price <= 0) {
        showToast('Price must be greater than 0', 'error');
        return false;
      }
      if (!data.category) {
        showToast('Please select a category', 'error');
        return false;
      }
      if (data.stock < 0) {
        showToast('Stock cannot be negative', 'error');
        return false;
      }
      if (!data.description || data.description.length < 10) {
        showToast('Description must be at least 10 characters', 'error');
        return false;
      }
      return true;
    }

    // Add new product
    function addProduct(productData) {
      const adminProducts = getAdminProducts();
      const newProduct = {
        id: generateProductId(),
        ...productData,
        createdAt: new Date().toISOString()
      };

      adminProducts.push(newProduct);
      saveAdminProducts(adminProducts);

      // Update stock
      const stockKey = `${newProduct.name}_${newProduct.category}`;
      updateProductStock(stockKey, productData.stock);

      showToast(`Product "${newProduct.name}" added successfully!`, 'success');
      logActivity(`Added product: ${newProduct.name}`);
      resetForm();
      showSection('products');
    }

    // Update existing product
    function updateProduct(productId, productData) {
      // Check if it's a default product or admin product
      const defaultProduct = defaultProducts.find(p => p.id === productId);

      if (defaultProduct) {
        // For default products, store modifications separately
        const modifications = JSON.parse(localStorage.getItem('productModifications')) || {};
        modifications[productId] = productData;
        localStorage.setItem('productModifications', JSON.stringify(modifications));

        // Update stock
        const stockKey = `${productData.name}_${productData.category}`;
        updateProductStock(stockKey, productData.stock);
      } else {
        // For admin products, update directly
        const adminProducts = getAdminProducts();
        const index = adminProducts.findIndex(p => p.id === productId);

        if (index !== -1) {
          const oldName = adminProducts[index].name;
          adminProducts[index] = { ...adminProducts[index], ...productData, updatedAt: new Date().toISOString() };
          saveAdminProducts(adminProducts);

          // Update stock
          const stockKey = `${productData.name}_${productData.category}`;
          updateProductStock(stockKey, productData.stock);
        }
      }

      showToast(`Product "${productData.name}" updated successfully!`, 'success');
      logActivity(`Updated product: ${productData.name}`);
      resetForm();
      showSection('products');
    }

    // Delete product
    function deleteProduct(productId) {
      const product = getAllProducts().find(p => p.id === productId);
      if (!product) return;

      // Check if it's a default product
      const isDefault = defaultProducts.some(p => p.id === productId);

      if (isDefault) {
        // Mark default product as deleted
        const deletedProducts = JSON.parse(localStorage.getItem('deletedProducts')) || [];
        if (!deletedProducts.includes(productId)) {
          deletedProducts.push(productId);
          localStorage.setItem('deletedProducts', JSON.stringify(deletedProducts));
        }
      } else {
        // Remove admin product
        const adminProducts = getAdminProducts().filter(p => p.id !== productId);
        saveAdminProducts(adminProducts);
      }

      showToast(`Product "${product.name}" deleted successfully!`, 'success');
      logActivity(`Deleted product: ${product.name}`);
      renderProductTable();
      updateDashboardStats();
    }

    // Edit product - load data into form
    function editProduct(productId) {
      const product = getAllProducts().find(p => p.id === productId);
      if (!product) return;

      // Check for modifications
      const modifications = JSON.parse(localStorage.getItem('productModifications')) || {};
      const modifiedData = modifications[productId] || {};
      const productData = { ...product, ...modifiedData };

      // Populate form
      document.getElementById('productId').value = productId;
      document.getElementById('productName').value = productData.name;
      document.getElementById('productPrice').value = productData.price;
      document.getElementById('productCategory').value = productData.category;
      document.getElementById('productIcon').value = productData.icon || 'üì¶';
      document.getElementById('productImage').value = productData.image || '';
      document.getElementById('productDescription').value = productData.description;

      // Get current stock
      const stockKey = `${productData.name}_${productData.category}`;
      const currentStock = getProductStock(stockKey);
      document.getElementById('productStock').value = currentStock;

      // Update form title
      document.getElementById('formTitle').innerHTML = '<span>‚úèÔ∏è</span> Edit Product';
      document.getElementById('submitBtn').innerHTML = '<span>üíæ</span> Update Product';

      showSection('add-product');
    }

    // Reset form
    function resetForm() {
      document.getElementById('productForm').reset();
      document.getElementById('productId').value = '';
      document.getElementById('formTitle').innerHTML = '<span>‚ûï</span> Add New Product';
      document.getElementById('submitBtn').innerHTML = '<span>üíæ</span> Save Product';
    }

    /* ============================================
       PRODUCT TABLE RENDERING
       ============================================ */

    // Render product table
    function renderProductTable() {
      const tbody = document.getElementById('productTableBody');
      const deletedProducts = JSON.parse(localStorage.getItem('deletedProducts')) || [];
      const modifications = JSON.parse(localStorage.getItem('productModifications')) || {};

      let products = getAllProducts()
        .filter(p => !deletedProducts.includes(p.id))
        .map(p => ({ ...p, ...modifications[p.id] }));

      // Apply filters
      const searchTerm = document.getElementById('productSearch').value.toLowerCase();
      const categoryFilter = document.getElementById('categoryFilter').value;

      if (searchTerm) {
        products = products.filter(p =>
          p.name.toLowerCase().includes(searchTerm) ||
          p.description.toLowerCase().includes(searchTerm)
        );
      }

      if (categoryFilter) {
        products = products.filter(p => p.category === categoryFilter);
      }

      // Show/hide empty state
      const noProductsMsg = document.getElementById('noProductsMessage');
      if (products.length === 0) {
        tbody.innerHTML = '';
        noProductsMsg.style.display = 'block';
        return;
      }
      noProductsMsg.style.display = 'none';

      // Render rows
      tbody.innerHTML = products.map(product => {
        const stockKey = `${product.name}_${product.category}`;
        const stock = getProductStock(stockKey);
        const stockClass = stock === 0 ? 'out-of-stock' : stock <= 5 ? 'low-stock' : 'in-stock';
        const stockLabel = stock === 0 ? 'Out of Stock' : stock <= 5 ? `Low (${stock})` : `${stock} units`;

        return `
          <tr>
            <td><span class="product-icon">${product.icon || 'üì¶'}</span></td>
            <td>
              <span class="product-name">${escapeHtml(product.name)}</span>
            </td>
            <td><span class="product-category">${product.category}</span></td>
            <td><span class="product-price">‚Çπ${product.price}</span></td>
            <td><span class="stock-badge ${stockClass}">${stockLabel}</span></td>
            <td>
              <div class="action-buttons">
                <button class="action-btn edit-btn" onclick="editProduct(${product.id})" title="Edit">
                  ‚úèÔ∏è
                </button>
                <button class="action-btn delete-btn" onclick="showDeleteModal(${product.id}, '${escapeHtml(product.name)}')" title="Delete">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // Filter products
    function filterProducts() {
      renderProductTable();
    }

    // Populate category filter
    function populateCategoryFilter() {
      const categories = [...new Set(getAllProducts().map(p => p.category))];
      const select = document.getElementById('categoryFilter');

      select.innerHTML = '<option value="">All Categories</option>' +
        categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
    }

    /* ============================================
       STOCK TABLE MANAGEMENT
       ============================================ */

    // Render stock table
    function renderStockTable() {
      const tbody = document.getElementById('stockTableBody');
      const deletedProducts = JSON.parse(localStorage.getItem('deletedProducts')) || [];
      const modifications = JSON.parse(localStorage.getItem('productModifications')) || {};

      let products = getAllProducts()
        .filter(p => !deletedProducts.includes(p.id))
        .map(p => ({ ...p, ...modifications[p.id] }));

      // Apply filters
      const searchTerm = document.getElementById('stockSearch').value.toLowerCase();
      const stockFilter = document.getElementById('stockFilter').value;

      if (searchTerm) {
        products = products.filter(p =>
          p.name.toLowerCase().includes(searchTerm)
        );
      }

      if (stockFilter) {
        products = products.filter(p => {
          const stockKey = `${p.name}_${p.category}`;
          const stock = getProductStock(stockKey);

          switch (stockFilter) {
            case 'out': return stock === 0;
            case 'low': return stock >= 1 && stock <= 5;
            case 'normal': return stock > 5;
            default: return true;
          }
        });
      }

      // Render rows
      tbody.innerHTML = products.map(product => {
        const stockKey = `${product.name}_${product.category}`;
        const stock = getProductStock(stockKey);
        const stockClass = stock === 0 ? 'out-of-stock' : stock <= 5 ? 'low-stock' : 'in-stock';

        return `
          <tr>
            <td><span class="product-icon">${product.icon || 'üì¶'}</span></td>
            <td><span class="product-name">${escapeHtml(product.name)}</span></td>
            <td><span class="product-category">${product.category}</span></td>
            <td><span class="stock-badge ${stockClass}">${stock} units</span></td>
            <td>
              <div class="stock-controls">
                <button class="stock-btn decrease" onclick="adjustStock('${stockKey}', -1)" title="Decrease">‚àí</button>
                <input
                  type="number"
                  class="stock-input"
                  value="${stock}"
                  min="0"
                  onchange="setStock('${stockKey}', this.value)"
                  data-stock-key="${stockKey}"
                >
                <button class="stock-btn increase" onclick="adjustStock('${stockKey}', 1)" title="Increase">+</button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // Filter stock table
    function filterStockTable() {
      renderStockTable();
    }

    // Adjust stock by increment
    function adjustStock(stockKey, increment) {
      const currentStock = getProductStock(stockKey);
      const newStock = Math.max(0, currentStock + increment);
      updateProductStock(stockKey, newStock);

      // Update input field
      const input = document.querySelector(`input[data-stock-key="${stockKey}"]`);
      if (input) {
        input.value = newStock;
      }

      renderStockTable();
      updateDashboardStats();

      const action = increment > 0 ? 'increased' : 'decreased';
      showToast(`Stock ${action} to ${newStock}`, 'success');
    }

    // Set stock directly
    function setStock(stockKey, value) {
      const newStock = Math.max(0, parseInt(value) || 0);
      updateProductStock(stockKey, newStock);
      renderStockTable();
      updateDashboardStats();
      showToast(`Stock updated to ${newStock}`, 'success');
    }

    /* ============================================
       DELETE MODAL
       ============================================ */

    let productToDelete = null;

    function showDeleteModal(productId, productName) {
      productToDelete = productId;
      document.getElementById('deleteProductName').textContent = productName;
      document.getElementById('deleteModal').classList.add('active');
    }

    function closeDeleteModal() {
      productToDelete = null;
      document.getElementById('deleteModal').classList.remove('active');
    }

    document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
      if (productToDelete) {
        deleteProduct(productToDelete);
        closeDeleteModal();
      }
    });

    // Close modal on outside click
    document.getElementById('deleteModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeDeleteModal();
      }
    });

    /* ============================================
       DASHBOARD STATISTICS
       ============================================ */

    function updateDashboardStats() {
      const deletedProducts = JSON.parse(localStorage.getItem('deletedProducts')) || [];
      const modifications = JSON.parse(localStorage.getItem('productModifications')) || {};

      const products = getAllProducts()
        .filter(p => !deletedProducts.includes(p.id))
        .map(p => ({ ...p, ...modifications[p.id] }));

      // Total products
      document.getElementById('totalProducts').textContent = products.length;

      // Total categories
      const categories = [...new Set(products.map(p => p.category))];
      document.getElementById('totalCategories').textContent = categories.length;

      // Total stock
      let totalStock = 0;
      let lowStockCount = 0;

      products.forEach(product => {
        const stockKey = `${product.name}_${product.category}`;
        const stock = getProductStock(stockKey);
        totalStock += stock;
        if (stock <= 5) lowStockCount++;
      });

      document.getElementById('totalStock').textContent = totalStock;
      document.getElementById('lowStockCount').textContent = lowStockCount;
    }

    /* ============================================
       ACTIVITY LOG
       ============================================ */

    function logActivity(message) {
      const activities = JSON.parse(localStorage.getItem('adminActivities')) || [];
      activities.unshift({
        message,
        timestamp: new Date().toISOString()
      });

      // Keep only last 10 activities
      localStorage.setItem('adminActivities', JSON.stringify(activities.slice(0, 10)));
      renderRecentActivity();
    }

    function renderRecentActivity() {
      const container = document.getElementById('recentActivity');
      const activities = JSON.parse(localStorage.getItem('adminActivities')) || [];

      if (activities.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="icon">üìã</div>
            <h3>No Recent Activity</h3>
            <p>Product changes will appear here</p>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <ul style="list-style: none; padding: 0;">
          ${activities.map(activity => {
            const date = new Date(activity.timestamp);
            const timeStr = date.toLocaleString();
            return `
              <li style="padding: 12px 0; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <span>${escapeHtml(activity.message)}</span>
                <small style="color: var(--text-muted);">${timeStr}</small>
              </li>
            `;
          }).join('')}
        </ul>
      `;
    }

    /* ============================================
       TOAST NOTIFICATIONS
       ============================================ */

    function showToast(message, type = 'success') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;

      const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
      toast.innerHTML = `<span>${icon}</span> ${escapeHtml(message)}`;

      container.appendChild(toast);

      // Remove toast after 3 seconds
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    /* ============================================
       UTILITY FUNCTIONS
       ============================================ */

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    /* ============================================
       INITIALIZATION
       ============================================ */

    function initializeDashboard() {
      initDarkMode();
      populateCategoryFilter();
      initializeDefaultStock();
      updateDashboardStats();
      renderRecentActivity();
      renderProductTable();
      renderStockTable();
    }

    // Initialize default stock values if not set
    function initializeDefaultStock() {
      const existingStock = JSON.parse(localStorage.getItem('productStock')) || {};
      const modifications = JSON.parse(localStorage.getItem('productModifications')) || {};

      // Set default stock for products that don't have stock set
      getAllProducts().forEach(product => {
        const modifiedProduct = { ...product, ...modifications[product.id] };
        const stockKey = `${modifiedProduct.name}_${modifiedProduct.category}`;

        if (existingStock[stockKey] === undefined) {
          existingStock[stockKey] = 10; // Default stock of 10
        }
      });

      localStorage.setItem('productStock', JSON.stringify(existingStock));
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      initDarkMode();
      checkAuthStatus();
    });

    // Sync products on storage change (for multi-tab support)
    window.addEventListener('storage', function(e) {
      if (e.key === 'adminProducts' || e.key === 'productStock') {
        renderProductTable();
        renderStockTable();
        updateDashboardStats();
      }
    });
  </script>
</body>
</html>
