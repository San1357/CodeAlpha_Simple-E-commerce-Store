<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopping Cart - E-commerce Store</title>
  <style>
    /* CSS Variables for Theming */
    :root {
      --bg-primary: #f7f7f7;
      --bg-secondary: #fff;
      --bg-card: #fff;
      --bg-input: #fff;
      --bg-hover: #f5f5f5;
      --text-primary: #333;
      --text-secondary: #666;
      --text-muted: #888;
      --border-color: #ddd;
      --border-light: #eee;
      --shadow-color: rgba(0,0,0,0.08);
      --accent-color: #0074d9;
      --accent-hover: #005fa3;
      --accent-light: #e7f7ff;
      --danger-color: #e74c3c;
      --success-color: #27ae60;
      --theme-transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    body.dark-mode {
      --bg-primary: #1a1a2e;
      --bg-secondary: #16213e;
      --bg-card: #1f2940;
      --bg-input: #2a3a5a;
      --bg-hover: #2a3a5a;
      --text-primary: #e8e8e8;
      --text-secondary: #b8b8b8;
      --text-muted: #888;
      --border-color: #3a4a6a;
      --border-light: #2a3a5a;
      --shadow-color: rgba(0,0,0,0.3);
      --accent-color: #4da6ff;
      --accent-hover: #3d96ef;
      --accent-light: #1a3a5a;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      transition: var(--theme-transition);
    }

    /* Header */
    .header {
      background: var(--bg-secondary);
      padding: 1rem 2rem;
      box-shadow: 0 2px 8px var(--shadow-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: var(--theme-transition);
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-color);
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .nav-links a {
      color: var(--text-primary);
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      transition: var(--theme-transition);
    }

    .nav-links a:hover {
      background: var(--accent-color);
      color: #fff;
    }

    /* Dark Mode Toggle */
    .theme-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--bg-hover);
      border: 2px solid var(--border-color);
      cursor: pointer;
      font-size: 1.2rem;
      transition: var(--theme-transition);
    }
    .theme-toggle:hover {
      background: var(--accent-light);
      border-color: var(--accent-color);
    }
    .theme-toggle .sun-icon { display: none; }
    .theme-toggle .moon-icon { display: block; }
    body.dark-mode .theme-toggle .sun-icon { display: block; }
    body.dark-mode .theme-toggle .moon-icon { display: none; }

    /* Language Selector */
    .lang-selector-wrapper {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .lang-icon {
      font-size: 1.1rem;
    }

    .lang-selector {
      padding: 0.4rem 0.6rem;
      font-size: 0.9rem;
      border: 1.5px solid #0074d9;
      border-radius: 5px;
      background: #fff;
      color: #0074d9;
      cursor: pointer;
      outline: none;
      font-weight: 500;
      transition: all 0.2s;
    }

    .lang-selector:hover {
      background: #e7f7ff;
    }

    .lang-selector:focus {
      box-shadow: 0 0 0 3px rgba(0, 116, 217, 0.15);
    }

    /* Cart Icon */
    .cart-icon-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.5rem 1rem;
      color: #333;
      text-decoration: none;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
    }

    .cart-icon-wrapper:hover {
      background: #0074d9;
      color: #fff;
    }

    .cart-icon {
      font-size: 1.3rem;
    }

    .cart-badge {
      position: absolute;
      top: -2px;
      right: 2px;
      background: #e74c3c;
      color: #fff;
      font-size: 0.7rem;
      font-weight: 700;
      min-width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
    }

    .cart-badge.hidden {
      display: none;
    }

    /* Wishlist Icon */
    .wishlist-icon-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.5rem 1rem;
      color: #333;
      text-decoration: none;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
    }

    .wishlist-icon-wrapper:hover {
      background: #e74c3c;
      color: #fff;
    }

    .wishlist-icon {
      font-size: 1.3rem;
    }

    .wishlist-badge {
      position: absolute;
      top: -2px;
      right: 2px;
      background: #e74c3c;
      color: #fff;
      font-size: 0.7rem;
      font-weight: 700;
      min-width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wishlist-badge.hidden {
      display: none;
    }

    /* Main Container */
    .main-container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    /* Page Title */
    .page-title {
      font-size: 1.8rem;
      color: #222;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .page-title .icon {
      font-size: 1.6rem;
    }

    /* Cart Container */
    .cart-container {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    /* Cart Items Section */
    .cart-items-section {
      flex: 2;
      min-width: 300px;
    }

    /* Cart Item Card */
    .cart-item {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      padding: 1.2rem;
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      transition: transform 0.2s, opacity 0.3s;
    }

    .cart-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    /* Stock Warning Styles */
    .cart-item.stock-warning {
      border: 2px solid #e74c3c;
      background: #fff5f5;
    }

    .stock-warning-text {
      color: #e74c3c;
      font-size: 0.85rem;
      font-weight: 600;
      margin-top: 0.3rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .stock-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-top: 0.3rem;
    }

    .stock-badge.in-stock {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .stock-badge.low-stock {
      background: #fff3e0;
      color: #ef6c00;
    }

    .stock-badge.out-of-stock {
      background: #ffebee;
      color: #c62828;
    }

    .cart-item.removing {
      opacity: 0;
      transform: translateX(-100%);
    }

    .item-image {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #e7f7ff 0%, #f1f1f1 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      flex-shrink: 0;
    }

    .item-details {
      flex: 1;
      min-width: 0;
    }

    .item-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: #222;
      margin-bottom: 0.3rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .item-price {
      color: #0074d9;
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .item-subtotal {
      color: #555;
      font-size: 0.9rem;
    }

    .item-subtotal span {
      font-weight: 600;
      color: #333;
    }

    /* Quantity Controls */
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: #f5f5f5;
      border-radius: 25px;
      padding: 0.3rem;
    }

    .qty-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: #0074d9;
      color: #fff;
      border-radius: 50%;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, transform 0.1s;
    }

    .qty-btn:hover {
      background: #005fa3;
    }

    .qty-btn:active {
      transform: scale(0.95);
    }

    .qty-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .qty-value {
      min-width: 35px;
      text-align: center;
      font-weight: 600;
      font-size: 1rem;
      color: #333;
    }

    /* Remove Button */
    .remove-btn {
      background: none;
      border: none;
      color: #e74c3c;
      font-size: 1.3rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: background 0.2s, transform 0.2s;
    }

    .remove-btn:hover {
      background: #fdeaea;
      transform: scale(1.1);
    }

    /* Cart Summary Section */
    .cart-summary-section {
      flex: 1;
      min-width: 280px;
    }

    .cart-summary {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      padding: 1.5rem;
      position: sticky;
      top: 1rem;
    }

    .summary-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: #222;
      margin-bottom: 1rem;
      padding-bottom: 0.8rem;
      border-bottom: 2px solid #0074d9;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 0.7rem 0;
      border-bottom: 1px solid #eee;
      font-size: 0.95rem;
    }

    .summary-row:last-of-type {
      border-bottom: none;
    }

    .summary-row.total {
      font-size: 1.15rem;
      font-weight: 700;
      color: #0074d9;
      padding-top: 1rem;
      margin-top: 0.5rem;
      border-top: 2px solid #eee;
    }

    .summary-label {
      color: #555;
    }

    .summary-value {
      font-weight: 600;
      color: #333;
    }

    /* Checkout Button */
    .checkout-btn {
      width: 100%;
      padding: 1rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      background: #0074d9;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 1.5rem;
      transition: background 0.2s, transform 0.1s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .checkout-btn:hover {
      background: #005fa3;
    }

    .checkout-btn:active {
      transform: scale(0.98);
    }

    .checkout-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* Continue Shopping Link */
    .continue-shopping {
      display: block;
      text-align: center;
      margin-top: 1rem;
      color: #0074d9;
      text-decoration: none;
      font-size: 0.95rem;
    }

    .continue-shopping:hover {
      text-decoration: underline;
    }

    /* Empty Cart */
    .empty-cart {
      text-align: center;
      padding: 3rem;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }

    .empty-cart-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.6;
    }

    .empty-cart-title {
      font-size: 1.5rem;
      color: #333;
      margin-bottom: 0.5rem;
    }

    .empty-cart-text {
      color: #666;
      margin-bottom: 1.5rem;
    }

    .shop-now-btn {
      display: inline-block;
      padding: 0.8rem 2rem;
      background: #0074d9;
      color: #fff;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      transition: background 0.2s;
    }

    .shop-now-btn:hover {
      background: #005fa3;
    }

    /* Clear Cart Button */
    .clear-cart-btn {
      background: none;
      border: 2px solid #e74c3c;
      color: #e74c3c;
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 1rem;
    }

    .clear-cart-btn:hover {
      background: #e74c3c;
      color: #fff;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .cart-container {
        flex-direction: column;
      }

      .cart-summary-section {
        order: -1;
      }

      .cart-summary {
        position: static;
      }

      .cart-item {
        flex-wrap: wrap;
      }

      .item-details {
        flex-basis: calc(100% - 100px);
      }

      .quantity-controls {
        margin-left: auto;
      }
    }

    @media (max-width: 500px) {
      .header {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }

      .main-container {
        margin: 1rem auto;
      }

      .page-title {
        font-size: 1.4rem;
      }

      .cart-item {
        padding: 1rem;
      }

      .item-image {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
      }

      .item-name {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="index.html" class="logo" data-i18n="shopease">ShopEase</a>
    <nav class="nav-links">
      <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
        <span class="moon-icon">üåô</span>
        <span class="sun-icon">‚òÄÔ∏è</span>
      </button>
      <div class="lang-selector-wrapper">
        <span class="lang-icon">üåê</span>
        <select id="language-selector" class="lang-selector">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
          <option value="bho">‡§≠‡•ã‡§ú‡§™‡•Å‡§∞‡•Ä</option>
        </select>
      </div>
      <a href="index.html" data-i18n="home">Home</a>
      <!-- Wishlist Icon -->
      <a href="wishlist.html" class="wishlist-icon-wrapper">
        <span class="wishlist-icon">‚ù§Ô∏è</span>
        <span class="wishlist-badge hidden" id="wishlistBadge">0</span>
      </a>
      <!-- Cart Icon -->
      <a href="cart.html" class="cart-icon-wrapper">
        <span class="cart-icon">üõí</span>
        <span class="cart-badge hidden" id="cartBadge">0</span>
      </a>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="main-container">
    <h1 class="page-title">
      <span class="icon">üõí</span>
      <span data-i18n="shoppingCart">Shopping Cart</span>
    </h1>

    <!-- Cart Content (will be rendered by JS) -->
    <div id="cartContent">
      <!-- Loading state -->
      <div class="empty-cart">
        <div class="empty-cart-icon">‚è≥</div>
        <div class="empty-cart-title">Loading...</div>
      </div>
    </div>
  </main>

  <!-- Language/i18n Script -->
  <script src="lang.js"></script>
  <script>
    // ========================================
    // CART MANAGEMENT SYSTEM
    // ========================================

    // Get cart from localStorage
    function getCart() {
      return JSON.parse(localStorage.getItem('cartItems')) || [];
    }

    // Save cart to localStorage
    function saveCart(cart) {
      localStorage.setItem('cartItems', JSON.stringify(cart));
      updateCartBadge();
    }

    // Update cart badge count
    function updateCartBadge() {
      const cart = getCart();
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const badge = document.getElementById('cartBadge');

      if (badge) {
        badge.textContent = totalItems;
        if (totalItems > 0) {
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }
      }
    }

    // Get wishlist from localStorage
    function getWishlist() {
      return JSON.parse(localStorage.getItem('wishlistItems')) || [];
    }

    // Update wishlist badge count
    function updateWishlistBadge() {
      const wishlist = getWishlist();
      const badge = document.getElementById('wishlistBadge');

      if (badge) {
        badge.textContent = wishlist.length;
        if (wishlist.length > 0) {
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }
      }
    }

    // ========================================
    // STOCK MANAGEMENT FUNCTIONS
    // ========================================

    /**
     * Default stock values for initialization
     */
    const defaultStock = {
      'Reynolds_Pen': 15,
      'Cello_Pen': 8,
      'Parker_Pen': 3,
      'Linc_Pen': 20,
      'Flair_Pen': 12,
      'Pilot_Pen': 5,
      'Nataraj_Pencil': 25,
      'Apsara_Pencil': 18,
      'Camlin_Pencil': 10,
      'Classmate_Notebook': 7,
      'Navneet_Notebook': 4,
      'Doms_Notebook': 0,
      'Apsara_Sharpener': 30,
      'Nataraj_Sharpener': 15,
      'Camlin_Sharpener': 2,
      'Nataraj_Eraser': 22,
      'Apsara_Eraser': 0,
      'Camlin_Eraser': 6
    };

    /**
     * Initialize stock if not exists
     */
    function initializeStock() {
      const existingStock = localStorage.getItem('productStock');
      if (!existingStock) {
        localStorage.setItem('productStock', JSON.stringify(defaultStock));
      }
    }

    /**
     * Get all stock data
     */
    function getAllStock() {
      initializeStock();
      return JSON.parse(localStorage.getItem('productStock')) || {};
    }

    /**
     * Get stock for specific product
     */
    function getProductStock(productId) {
      const stock = getAllStock();
      return stock[productId] !== undefined ? stock[productId] : 0;
    }

    /**
     * Get stock status badge HTML
     */
    function getStockBadge(productId, cartQty) {
      const stock = getProductStock(productId);

      if (stock === 0) {
        return `<span class="stock-badge out-of-stock">‚ùå ${t('outOfStock')}</span>`;
      } else if (cartQty > stock) {
        return `<span class="stock-warning-text">‚ö†Ô∏è ${t('stockUpdated')}</span>`;
      } else if (stock <= 5) {
        return `<span class="stock-badge low-stock">‚ö†Ô∏è ${t('lowStock').replace('{count}', stock)}</span>`;
      } else {
        return `<span class="stock-badge in-stock">‚úÖ ${t('available')}</span>`;
      }
    }

    /**
     * Check if any cart item has stock issues
     */
    function hasStockIssues() {
      const cart = getCart();
      return cart.some(item => {
        const stock = getProductStock(item.id);
        return item.quantity > stock;
      });
    }

    // Get product icon based on name
    function getProductIcon(name) {
      const nameLower = name.toLowerCase();
      if (nameLower.includes('pen')) return 'üñäÔ∏è';
      if (nameLower.includes('pencil')) return '‚úèÔ∏è';
      if (nameLower.includes('notebook') || nameLower.includes('book')) return 'üìì';
      if (nameLower.includes('sharpener')) return 'üî™';
      if (nameLower.includes('eraser')) return 'üßΩ';
      return 'üì¶';
    }

    // Render cart items
    function renderCart() {
      const cart = getCart();
      const cartContent = document.getElementById('cartContent');

      if (cart.length === 0) {
        // Empty cart state
        cartContent.innerHTML = `
          <div class="empty-cart">
            <div class="empty-cart-icon">üõí</div>
            <div class="empty-cart-title" data-i18n="emptyCart">${t('emptyCart')}</div>
            <div class="empty-cart-text" data-i18n="emptyCartText">${t('emptyCartText')}</div>
            <a href="index.html" class="shop-now-btn" data-i18n="shopNow">${t('shopNow')}</a>
          </div>
        `;
        return;
      }

      // Calculate totals
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const grandTotal = subtotal; // Could add tax/shipping here

      // Build cart HTML with stock validation
      let cartItemsHTML = '';
      cart.forEach((item, index) => {
        const itemSubtotal = item.price * item.quantity;
        const stock = getProductStock(item.id);
        const hasStockIssue = item.quantity > stock;
        const stockBadgeHTML = getStockBadge(item.id, item.quantity);

        // Determine button states based on stock
        const decreaseDisabled = item.quantity <= 1;
        const increaseDisabled = item.quantity >= stock || stock === 0;

        cartItemsHTML += `
          <div class="cart-item ${hasStockIssue ? 'stock-warning' : ''}" data-index="${index}">
            <div class="item-image">${getProductIcon(item.name)}</div>
            <div class="item-details">
              <div class="item-name">${item.name}</div>
              <div class="item-price">‚Çπ${item.price}</div>
              <div class="item-subtotal" data-i18n-text="subtotal">${t('subtotal')}: <span>‚Çπ${itemSubtotal}</span></div>
              ${stockBadgeHTML}
            </div>
            <div class="quantity-controls">
              <button class="qty-btn" onclick="updateQuantity(${index}, -1)" ${decreaseDisabled ? 'disabled' : ''}>‚àí</button>
              <span class="qty-value">${item.quantity}</span>
              <button class="qty-btn" onclick="updateQuantity(${index}, 1)" ${increaseDisabled ? 'disabled' : ''}>+</button>
            </div>
            <button class="remove-btn" onclick="removeItem(${index})" title="${t('removeFromCart')}">üóëÔ∏è</button>
          </div>
        `;
      });

      cartContent.innerHTML = `
        <div class="cart-container">
          <div class="cart-items-section">
            <button class="clear-cart-btn" onclick="clearCart()" data-i18n="clearCart">${t('clearCart')}</button>
            ${cartItemsHTML}
          </div>
          <div class="cart-summary-section">
            <div class="cart-summary">
              <div class="summary-title" data-i18n="orderSummary">${t('orderSummary')}</div>
              <div class="summary-row">
                <span class="summary-label" data-i18n="totalItems">${t('totalItems')}</span>
                <span class="summary-value">${totalItems}</span>
              </div>
              <div class="summary-row">
                <span class="summary-label" data-i18n="subtotal">${t('subtotal')}</span>
                <span class="summary-value">‚Çπ${subtotal}</span>
              </div>
              <div class="summary-row total">
                <span class="summary-label" data-i18n="grandTotal">${t('grandTotal')}</span>
                <span class="summary-value">‚Çπ${grandTotal}</span>
              </div>
              <button class="checkout-btn" onclick="proceedToCheckout()" data-i18n="proceedToCheckout">
                ${t('proceedToCheckout')} ‚Üí
              </button>
              <a href="index.html" class="continue-shopping" data-i18n="continueShopping">${t('continueShopping')}</a>
            </div>
          </div>
        </div>
      `;
    }

    // Update item quantity with stock validation
    function updateQuantity(index, change) {
      const cart = getCart();

      if (cart[index]) {
        const newQuantity = cart[index].quantity + change;
        const stock = getProductStock(cart[index].id);

        // Check stock before increasing
        if (change > 0 && newQuantity > stock) {
          alert(t('stockWarning').replace('{count}', stock));
          return;
        }

        cart[index].quantity = newQuantity;

        // Remove if quantity becomes 0
        if (cart[index].quantity <= 0) {
          removeItem(index);
          return;
        }

        saveCart(cart);
        renderCart();
      }
    }

    // Remove item from cart
    function removeItem(index) {
      const cart = getCart();
      const cartItem = document.querySelector(`.cart-item[data-index="${index}"]`);

      // Add removing animation
      if (cartItem) {
        cartItem.classList.add('removing');
        setTimeout(() => {
          cart.splice(index, 1);
          saveCart(cart);
          renderCart();
        }, 300);
      } else {
        cart.splice(index, 1);
        saveCart(cart);
        renderCart();
      }
    }

    // Clear entire cart
    function clearCart() {
      if (confirm(t('confirmClearCart'))) {
        localStorage.removeItem('cartItems');
        updateCartBadge();
        renderCart();
      }
    }

    // Proceed to checkout with stock validation
    function proceedToCheckout() {
      const cart = getCart();

      if (cart.length === 0) {
        alert(t('emptyCartCheckout'));
        return;
      }

      // Validate stock for all items
      if (hasStockIssues()) {
        alert(t('someItemsOutOfStock'));
        return;
      }

      // Calculate totals for checkout
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

      // Save checkout items
      localStorage.setItem('checkoutItems', JSON.stringify(cart));
      localStorage.setItem('checkoutFromCart', 'true');

      // For compatibility with existing checkout, also set checkoutProduct
      // This creates a combined product for the existing checkout flow
      localStorage.setItem('checkoutProduct', JSON.stringify({
        name: `${totalItems} ${totalItems === 1 ? 'item' : 'items'}`,
        price: subtotal,
        quantity: 1,
        isCartCheckout: true,
        items: cart
      }));

      // Redirect to checkout
      window.location.href = 'checkout.html';
    }

    // Initialize cart page
    function initCart() {
      // Initialize stock data
      initializeStock();

      updateCartBadge();
      updateWishlistBadge();
      renderCart();
    }

    // Re-render on language change
    window.addEventListener('languageChanged', function() {
      renderCart();
    });

    // Initialize on page load
    initCart();

    // ========================================
    // DARK MODE SYSTEM
    // ========================================
    function getCurrentTheme() {
      return localStorage.getItem('themeMode') || 'light';
    }
    function setTheme(theme) {
      localStorage.setItem('themeMode', theme);
    }
    function applyTheme(theme) {
      if (theme === 'dark') {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    }
    function toggleTheme() {
      const current = getCurrentTheme();
      const newTheme = current === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
      applyTheme(newTheme);
    }
    function initDarkMode() {
      const savedTheme = getCurrentTheme();
      applyTheme(savedTheme);
      const toggle = document.getElementById('themeToggle');
      if (toggle) {
        toggle.addEventListener('click', toggleTheme);
      }
    }
    initDarkMode();
  </script>
</body>
</html>
