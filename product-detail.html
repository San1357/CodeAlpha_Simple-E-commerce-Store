<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Detail</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* CSS Variables for Theming */
    :root {
      --bg-primary: #f7f7f7;
      --bg-secondary: #fff;
      --bg-card: #fff;
      --bg-input: #fff;
      --bg-hover: #f5f5f5;
      --text-primary: #333;
      --text-secondary: #555;
      --text-muted: #888;
      --border-color: #ddd;
      --border-light: #eee;
      --shadow-color: rgba(0,0,0,0.08);
      --accent-color: #0074d9;
      --accent-hover: #005fa3;
      --accent-light: #e7f7ff;
      --danger-color: #e74c3c;
      --success-color: #27ae60;
      --theme-transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    body.dark-mode {
      --bg-primary: #1a1a2e;
      --bg-secondary: #16213e;
      --bg-card: #1f2940;
      --bg-input: #2a3a5a;
      --bg-hover: #2a3a5a;
      --text-primary: #e8e8e8;
      --text-secondary: #b8b8b8;
      --text-muted: #888;
      --border-color: #3a4a6a;
      --border-light: #2a3a5a;
      --shadow-color: rgba(0,0,0,0.3);
      --accent-color: #4da6ff;
      --accent-hover: #3d96ef;
      --accent-light: #1a3a5a;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      background: var(--bg-primary);
      font-family: Arial, sans-serif;
      min-height: 100vh;
      color: var(--text-primary);
      transition: var(--theme-transition);
    }
    /* Header */
    .header {
      background: var(--bg-secondary);
      padding: 1rem 2rem;
      box-shadow: 0 2px 8px var(--shadow-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: var(--theme-transition);
    }
    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-color);
      text-decoration: none;
    }
    .nav-links {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    .nav-links a {
      color: var(--text-primary);
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      transition: var(--theme-transition);
    }
    .nav-links a:hover {
      background: var(--accent-color);
      color: #fff;
    }
    /* Dark Mode Toggle */
    .theme-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--bg-hover);
      border: 2px solid var(--border-color);
      cursor: pointer;
      font-size: 1.2rem;
      transition: var(--theme-transition);
    }
    .theme-toggle:hover {
      background: var(--accent-light);
      border-color: var(--accent-color);
    }
    .theme-toggle .sun-icon { display: none; }
    .theme-toggle .moon-icon { display: block; }
    body.dark-mode .theme-toggle .sun-icon { display: block; }
    body.dark-mode .theme-toggle .moon-icon { display: none; }
    /* Language Selector */
    .lang-selector-wrapper {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .lang-icon { font-size: 1.1rem; }
    .lang-selector {
      padding: 0.4rem 0.6rem;
      font-size: 0.9rem;
      border: 1.5px solid var(--accent-color);
      border-radius: 5px;
      background: var(--bg-secondary);
      color: var(--accent-color);
      cursor: pointer;
      outline: none;
      font-weight: 500;
      transition: var(--theme-transition);
    }
    .lang-selector:hover { background: var(--accent-light); }
    .lang-selector:focus { box-shadow: 0 0 0 3px rgba(0, 116, 217, 0.15); }
    /* Cart Icon */
    .cart-icon-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.5rem 1rem;
      color: #333;
      text-decoration: none;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
    }
    .cart-icon-wrapper:hover {
      background: #0074d9;
      color: #fff;
    }
    .cart-icon { font-size: 1.3rem; }
    .cart-badge {
      position: absolute;
      top: -2px;
      right: 2px;
      background: #e74c3c;
      color: #fff;
      font-size: 0.7rem;
      font-weight: 700;
      min-width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cart-badge.hidden { display: none; }
    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #27ae60;
      color: #fff;
      padding: 1rem 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 1000;
      opacity: 0;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    .toast-icon { font-size: 1.2rem; }

    /* Main Container */
    .main-container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    /* Product Card */
    .product-container {
      background: var(--bg-card);
      border-radius: 10px;
      box-shadow: 0 4px 24px var(--shadow-color);
      padding: 2rem 2.5rem 2.5rem 2.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 2rem;
      transition: var(--theme-transition);
    }
    .brand-name {
      font-size: 2rem;
      font-weight: bold;
      color: var(--accent-color);
      margin-bottom: 0.5rem;
      text-align: center;
    }
    .category {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin-bottom: 1.2rem;
      text-align: center;
    }
    .description {
      font-size: 1.05rem;
      color: var(--text-primary);
      margin-bottom: 1.2rem;
      text-align: center;
    }
    .price {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--text-primary);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .quantity-selector {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      margin-bottom: 2rem;
    }
    .qty-btn {
      background: var(--accent-color);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 1.5rem;
      cursor: pointer;
      transition: var(--theme-transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .qty-btn:hover {
      background: var(--accent-hover);
    }
    .qty-number {
      font-size: 1.2rem;
      min-width: 24px;
      text-align: center;
      color: var(--text-primary);
    }
    .actions {
      display: flex;
      gap: 1.2rem;
      margin-top: 1rem;
      width: 100%;
      justify-content: center;
    }
    .action-btn {
      padding: 0.7rem 1.6rem;
      font-size: 1.08rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s, color 0.2s;
    }
    .add-cart {
      background: #fff;
      color: #0074d9;
      border: 2px solid #0074d9;
    }
    .add-cart:hover {
      background: #0074d9;
      color: #fff;
    }
    .buy-now {
      background: #0074d9;
      color: #fff;
      border: 2px solid #0074d9;
    }
    .buy-now:hover {
      background: #005fa3;
      border-color: #005fa3;
    }

    /* ========================================
       STOCK STATUS STYLES
       ======================================== */
    .stock-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.95rem;
      font-weight: 600;
    }

    .stock-status.in-stock {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .stock-status.low-stock {
      background: #fff3e0;
      color: #ef6c00;
    }

    .stock-status.out-of-stock {
      background: #ffebee;
      color: #c62828;
    }

    .stock-icon {
      font-size: 1.1rem;
    }

    /* Disabled button styles */
    .action-btn:disabled,
    .qty-btn:disabled {
      background: #ccc !important;
      border-color: #ccc !important;
      color: #666 !important;
      cursor: not-allowed;
      opacity: 0.7;
    }

    .action-btn:disabled:hover,
    .qty-btn:disabled:hover {
      background: #ccc !important;
      color: #666 !important;
      transform: none;
    }

    /* ========================================
       RATING & REVIEW SECTION STYLES
       ======================================== */

    .reviews-section {
      background: var(--bg-card);
      border-radius: 10px;
      box-shadow: 0 4px 24px var(--shadow-color);
      padding: 2rem;
      transition: var(--theme-transition);
    }

    .reviews-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #eee;
    }

    .reviews-header-icon {
      font-size: 1.5rem;
    }

    .reviews-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: #333;
    }

    /* Average Rating Display */
    .average-rating-container {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 10px;
      margin-bottom: 2rem;
    }

    .average-rating-big {
      text-align: center;
    }

    .average-rating-number {
      font-size: 3rem;
      font-weight: 700;
      color: #0074d9;
      line-height: 1;
    }

    .average-rating-max {
      font-size: 1rem;
      color: #888;
    }

    .average-rating-details {
      flex: 1;
    }

    .average-stars {
      display: flex;
      gap: 0.3rem;
      margin-bottom: 0.5rem;
    }

    .average-stars .star {
      font-size: 1.5rem;
      color: #ddd;
    }

    .average-stars .star.filled {
      color: #ffc107;
    }

    .average-stars .star.half {
      background: linear-gradient(90deg, #ffc107 50%, #ddd 50%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .reviews-count-text {
      font-size: 0.95rem;
      color: #666;
    }

    /* Write Review Form */
    .write-review-container {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: #f9f9f9;
      border-radius: 10px;
      border: 1px solid #eee;
    }

    .write-review-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Star Rating Input */
    .rating-input-container {
      margin-bottom: 1rem;
    }

    .rating-label {
      font-size: 0.95rem;
      color: #555;
      margin-bottom: 0.5rem;
      display: block;
    }

    .star-rating-input {
      display: flex;
      gap: 0.3rem;
      flex-direction: row-reverse;
      justify-content: flex-end;
    }

    .star-rating-input input {
      display: none;
    }

    .star-rating-input label {
      font-size: 2rem;
      color: #ddd;
      cursor: pointer;
      transition: color 0.15s, transform 0.15s;
    }

    .star-rating-input label:hover,
    .star-rating-input label:hover ~ label,
    .star-rating-input input:checked ~ label {
      color: #ffc107;
    }

    .star-rating-input label:hover {
      transform: scale(1.2);
    }

    /* Review Textarea */
    .review-textarea {
      width: 100%;
      min-height: 100px;
      padding: 1rem;
      border: 1.5px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      resize: vertical;
      outline: none;
      transition: border-color 0.2s;
      margin-bottom: 1rem;
    }

    .review-textarea:focus {
      border-color: #0074d9;
    }

    .review-textarea::placeholder {
      color: #999;
    }

    /* Submit Button */
    .submit-review-btn {
      padding: 0.8rem 2rem;
      background: #0074d9;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, transform 0.15s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .submit-review-btn:hover {
      background: #005fa3;
      transform: translateY(-2px);
    }

    .submit-review-btn:active {
      transform: translateY(0);
    }

    /* Reviews List */
    .reviews-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .reviews-list-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Individual Review Card */
    .review-card {
      padding: 1.2rem;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
      transition: box-shadow 0.2s;
    }

    .review-card:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .review-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.8rem;
    }

    .review-stars {
      display: flex;
      gap: 0.2rem;
    }

    .review-stars .star {
      font-size: 1.1rem;
      color: #ddd;
    }

    .review-stars .star.filled {
      color: #ffc107;
    }

    .review-date {
      font-size: 0.85rem;
      color: #888;
    }

    .review-text {
      font-size: 0.95rem;
      color: #444;
      line-height: 1.5;
    }

    /* Empty Reviews State */
    .empty-reviews {
      text-align: center;
      padding: 3rem 2rem;
      background: #f9f9f9;
      border-radius: 10px;
      border: 2px dashed #ddd;
    }

    .empty-reviews-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-reviews-title {
      font-size: 1.2rem;
      color: #555;
      margin-bottom: 0.5rem;
    }

    .empty-reviews-text {
      color: #888;
      font-size: 0.95rem;
    }

    /* Validation Error */
    .validation-error {
      color: #e74c3c;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      display: none;
    }

    .validation-error.show {
      display: block;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .header { flex-direction: column; gap: 1rem; padding: 1rem; }

      .main-container {
        padding: 0 0.5rem;
        margin: 1rem auto;
      }

      .product-container {
        padding: 1.5rem 1rem;
      }

      .reviews-section {
        padding: 1.5rem 1rem;
      }

      .average-rating-container {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
      }

      .average-stars {
        justify-content: center;
      }

      .reviews-count-text {
        text-align: center;
      }

      .star-rating-input label {
        font-size: 1.8rem;
      }

      .review-card-header {
        flex-direction: column;
        gap: 0.5rem;
      }
    }

    /* Animation for new review */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .review-card.new {
      animation: slideIn 0.3s ease;
    }

    /* ========================================
       WISHLIST BUTTON & ICON STYLES
       ======================================== */

    /* Wishlist Icon in Navbar */
    .icon-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.5rem 1rem;
      color: #333;
      text-decoration: none;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
    }

    .icon-wrapper:hover {
      background: #0074d9;
      color: #fff;
    }

    .nav-icon {
      font-size: 1.3rem;
    }

    .badge {
      position: absolute;
      top: -2px;
      right: 2px;
      background: #e74c3c;
      color: #fff;
      font-size: 0.7rem;
      font-weight: 700;
      min-width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
    }

    .badge.hidden {
      display: none;
    }

    /* Add to Wishlist Button */
    .add-wishlist {
      background: #fff;
      color: #e74c3c;
      border: 2px solid #e74c3c;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .add-wishlist:hover {
      background: #e74c3c;
      color: #fff;
    }

    .add-wishlist.in-wishlist {
      background: #e74c3c;
      color: #fff;
    }

    .add-wishlist.in-wishlist:hover {
      background: #c0392b;
      border-color: #c0392b;
    }

    .wishlist-heart {
      font-size: 1.2rem;
      transition: transform 0.2s;
    }

    .add-wishlist:hover .wishlist-heart {
      transform: scale(1.2);
    }

    /* Heart Beat Animation */
    @keyframes heartBeat {
      0% { transform: scale(1); }
      25% { transform: scale(1.3); }
      50% { transform: scale(1); }
      75% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    .wishlist-heart.animate {
      animation: heartBeat 0.6s ease;
    }

    /* Toast Error State */
    .toast.error {
      background: #e74c3c;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="index.html" class="logo" data-i18n="shopease">ShopEase</a>
    <nav class="nav-links">
      <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
        <span class="moon-icon">üåô</span>
        <span class="sun-icon">‚òÄÔ∏è</span>
      </button>
      <div class="lang-selector-wrapper">
        <span class="lang-icon">üåê</span>
        <select id="language-selector" class="lang-selector">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
          <option value="bho">‡§≠‡•ã‡§ú‡§™‡•Å‡§∞‡•Ä</option>
        </select>
      </div>
      <a href="index.html" data-i18n="home">Home</a>
      <!-- Wishlist Icon -->
      <a href="wishlist.html" class="icon-wrapper" id="wishlistIconWrapper">
        <span class="nav-icon">‚ù§Ô∏è</span>
        <span class="badge hidden" id="wishlistBadge">0</span>
      </a>
      <!-- Cart Icon -->
      <a href="cart.html" class="icon-wrapper">
        <span class="nav-icon">üõí</span>
        <span class="badge hidden" id="cartBadge">0</span>
      </a>
    </nav>
  </header>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <span class="toast-icon">‚úì</span>
    <span id="toastMessage">Added to cart!</span>
  </div>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Product Details Card -->
    <div class="product-container">
      <div class="brand-name"></div>
      <div class="category"></div>
      <div class="description"></div>
      <div class="price"></div>
      <!-- Stock Status -->
      <div class="stock-status" id="stockStatus">
        <span class="stock-icon">üì¶</span>
        <span id="stockText">Loading...</span>
      </div>
      <div class="quantity-selector">
        <button class="qty-btn" id="decrease-btn">-</button>
        <span class="qty-number" id="qty-number">1</span>
        <button class="qty-btn" id="increase-btn">+</button>
      </div>
      <div class="actions">
        <button class="action-btn add-cart" id="add-cart-btn" data-i18n="addToCart">Add to Cart</button>
        <button class="action-btn buy-now" id="buy-now-btn" data-i18n="buyNow">Buy Now</button>
        <button class="action-btn add-wishlist" id="add-wishlist-btn">
          <span class="wishlist-heart" id="wishlistHeart">ü§ç</span>
          <span data-i18n="addToWishlist">Add to Wishlist</span>
        </button>
      </div>
    </div>

    <!-- ========================================
         RATINGS & REVIEWS SECTION
         ======================================== -->
    <div class="reviews-section">
      <!-- Section Header -->
      <div class="reviews-header">
        <span class="reviews-header-icon">‚≠ê</span>
        <h2 class="reviews-title" data-i18n="ratingsReviews">Ratings & Reviews</h2>
      </div>

      <!-- Average Rating Display -->
      <div class="average-rating-container" id="averageRatingContainer">
        <div class="average-rating-big">
          <div class="average-rating-number" id="avgRatingNumber">0.0</div>
          <div class="average-rating-max"><span data-i18n="outOf">out of</span> 5</div>
        </div>
        <div class="average-rating-details">
          <div class="average-stars" id="avgStarsDisplay">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="reviews-count-text">
            <span data-i18n="basedOn">Based on</span> <strong id="reviewsCountNum">0</strong> <span data-i18n="reviewsCount">reviews</span>
          </div>
        </div>
      </div>

      <!-- Write Review Form -->
      <div class="write-review-container">
        <h3 class="write-review-title">
          <span>‚úçÔ∏è</span>
          <span data-i18n="writeReview">Write a Review</span>
        </h3>

        <!-- Star Rating Input -->
        <div class="rating-input-container">
          <label class="rating-label" data-i18n="yourRating">Your Rating</label>
          <div class="star-rating-input" id="starRatingInput">
            <input type="radio" name="rating" value="5" id="star5">
            <label for="star5" title="5 stars">‚òÖ</label>
            <input type="radio" name="rating" value="4" id="star4">
            <label for="star4" title="4 stars">‚òÖ</label>
            <input type="radio" name="rating" value="3" id="star3">
            <label for="star3" title="3 stars">‚òÖ</label>
            <input type="radio" name="rating" value="2" id="star2">
            <label for="star2" title="2 stars">‚òÖ</label>
            <input type="radio" name="rating" value="1" id="star1">
            <label for="star1" title="1 star">‚òÖ</label>
          </div>
          <div class="validation-error" id="ratingError" data-i18n="selectRating">Please select a rating</div>
        </div>

        <!-- Review Text -->
        <label class="rating-label" data-i18n="yourReview">Your Review</label>
        <textarea
          class="review-textarea"
          id="reviewTextarea"
          data-i18n-placeholder="reviewPlaceholder"
          placeholder="Share your experience with this product..."
        ></textarea>
        <div class="validation-error" id="reviewError" data-i18n="writeReviewText">Please write your review</div>

        <!-- Submit Button -->
        <button class="submit-review-btn" id="submitReviewBtn">
          <span>üìù</span>
          <span data-i18n="submitReview">Submit Review</span>
        </button>
      </div>

      <!-- Reviews List -->
      <div class="reviews-list-container">
        <h3 class="reviews-list-title">
          <span>üí¨</span>
          <span data-i18n="reviews">Reviews</span>
          <span id="reviewsListCount">(0)</span>
        </h3>
        <div class="reviews-list" id="reviewsList">
          <!-- Reviews will be injected here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Language/i18n Script -->
  <script src="lang.js"></script>
  <script>
  // ========================================
  // PRODUCT DATA
  // ========================================
  const defaultProducts = [
    // Pens
    { brand: "Reynolds", category: "Pen", description: "Reynolds smooth writing ball pen with long-lasting blue ink, ideal for daily writing. Comfortable grip and lightweight design for effortless note-taking and exams.", price: "10" },
    { brand: "Cello", category: "Pen", description: "Fine tip gel pen, assorted colors.", price: "15" },
    { brand: "Parker", category: "Pen", description: "Premium rollerball pen, black ink.", price: "120" },
    { brand: "Linc", category: "Pen", description: "Affordable ball pen, blue ink.", price: "8" },
    { brand: "Flair", category: "Pen", description: "Stylish gel pen, quick dry.", price: "12" },
    { brand: "Pilot", category: "Pen", description: "Pilot premium gel pen with ultra-smooth ink flow, perfect for professionals and students.", price: "50" },
    // Pencils
    { brand: "Nataraj", category: "Pencil", description: "Nataraj HB wooden pencil, smooth writing.", price: "5" },
    { brand: "Apsara", category: "Pencil", description: "Apsara premium graphite pencil, dark lead.", price: "7" },
    { brand: "Camlin", category: "Pencil", description: "Camlin colored pencils, vibrant colors.", price: "20" },
    // Notebooks
    { brand: "Classmate", category: "Notebook", description: "Classmate ruled notebook, 200 pages.", price: "40" },
    { brand: "Navneet", category: "Notebook", description: "Navneet spiral notebook, 150 pages.", price: "35" },
    { brand: "Doms", category: "Notebook", description: "Doms hardcover notebook, 250 pages.", price: "60" },
    // Sharpeners
    { brand: "Apsara", category: "Sharpener", description: "Apsara plastic sharpener, single hole.", price: "10" },
    { brand: "Nataraj", category: "Sharpener", description: "Nataraj metal sharpener, double hole.", price: "15" },
    { brand: "Camlin", category: "Sharpener", description: "Camlin electric sharpener, battery operated.", price: "150" },
    // Erasers
    { brand: "Nataraj", category: "Eraser", description: "Nataraj soft eraser, ideal for pencil marks.", price: "8" },
    { brand: "Apsara", category: "Eraser", description: "Apsara plastic eraser, non-smudging.", price: "10" },
    { brand: "Camlin", category: "Eraser", description: "Camlin dust-free eraser, easy to use.", price: "9" }
  ];

  // ========================================
  // ADMIN PRODUCT SYNC FUNCTIONS
  // ========================================
  /**
   * Get admin-added products from localStorage
   * Converts admin format to product-detail format
   */
  function getAdminProducts() {
    const adminProducts = JSON.parse(localStorage.getItem('adminProducts')) || [];
    // Convert admin product format to product-detail format
    return adminProducts.map(p => ({
      brand: p.name,
      category: p.category,
      description: p.description,
      price: String(p.price)
    }));
  }

  /**
   * Get all products including admin-added ones
   */
  function getAllProducts() {
    const adminProducts = getAdminProducts();
    return [...defaultProducts, ...adminProducts];
  }

  // Dynamic products array that syncs with admin panel
  let products = getAllProducts();

  // ========================================
  // UTILITY FUNCTIONS
  // ========================================

  /**
   * Get brand from URL query parameter
   */
  function getBrandFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('brand');
  }

  /**
   * Find product by brand name
   */
  function getProductByBrand(brand) {
    return products.find(p => p.brand.toLowerCase() === brand.toLowerCase());
  }

  /**
   * Generate unique product ID for reviews storage
   */
  function getProductId(product) {
    return `${product.brand}_${product.category}`.toLowerCase().replace(/\s+/g, '_');
  }

  /**
   * Format date for display
   */
  function formatDate(timestamp) {
    const date = new Date(timestamp);
    const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
    return date.toLocaleDateString('en-IN', options);
  }

  /**
   * Render product details
   */
  function renderProductDetail(product) {
    document.querySelector('.brand-name').textContent = product.brand;
    document.querySelector('.category').textContent = `${t('category')}: ${product.category}`;
    document.querySelector('.description').textContent = product.description;
    document.querySelector('.price').textContent = `‚Çπ${product.price}`;
  }

  // ========================================
  // STOCK MANAGEMENT FUNCTIONS
  // ========================================

  /**
   * Default stock values for all products
   * This initializes stock if not already in localStorage
   */
  const defaultStock = {
    'Reynolds_Pen': 15,
    'Cello_Pen': 8,
    'Parker_Pen': 3,
    'Linc_Pen': 20,
    'Flair_Pen': 12,
    'Pilot_Pen': 5,
    'Nataraj_Pencil': 25,
    'Apsara_Pencil': 18,
    'Camlin_Pencil': 10,
    'Classmate_Notebook': 7,
    'Navneet_Notebook': 4,
    'Doms_Notebook': 0,
    'Apsara_Sharpener': 30,
    'Nataraj_Sharpener': 15,
    'Camlin_Sharpener': 2,
    'Nataraj_Eraser': 22,
    'Apsara_Eraser': 0,
    'Camlin_Eraser': 6
  };

  /**
   * Initialize stock data in localStorage if not exists
   */
  function initializeStock() {
    const existingStock = localStorage.getItem('productStock');
    if (!existingStock) {
      localStorage.setItem('productStock', JSON.stringify(defaultStock));
    }
  }

  /**
   * Get all stock data from localStorage
   * @returns {Object} Stock data object
   */
  function getAllStock() {
    initializeStock();
    return JSON.parse(localStorage.getItem('productStock')) || {};
  }

  /**
   * Get stock for a specific product
   * @param {string} productId - Product identifier (brand_category)
   * @returns {number} Available stock quantity
   */
  function getProductStock(productId) {
    const stock = getAllStock();
    return stock[productId] !== undefined ? stock[productId] : 0;
  }

  /**
   * Update stock for a specific product
   * @param {string} productId - Product identifier
   * @param {number} quantity - New stock quantity
   */
  function updateProductStock(productId, quantity) {
    const stock = getAllStock();
    stock[productId] = Math.max(0, quantity);
    localStorage.setItem('productStock', JSON.stringify(stock));
  }

  /**
   * Reduce stock after purchase
   * @param {string} productId - Product identifier
   * @param {number} quantity - Quantity to reduce
   */
  function reduceStock(productId, quantity) {
    const currentStock = getProductStock(productId);
    updateProductStock(productId, currentStock - quantity);
  }

  /**
   * Get stock status text and class
   * @param {number} stock - Current stock quantity
   * @returns {Object} { text, className, icon }
   */
  function getStockStatus(stock) {
    if (stock === 0) {
      return {
        text: t('outOfStock'),
        className: 'out-of-stock',
        icon: '‚ùå'
      };
    } else if (stock <= 5) {
      return {
        text: t('lowStock').replace('{count}', stock),
        className: 'low-stock',
        icon: '‚ö†Ô∏è'
      };
    } else {
      return {
        text: t('inStock'),
        className: 'in-stock',
        icon: '‚úÖ'
      };
    }
  }

  /**
   * Render stock status UI
   * @param {string} productId - Product identifier
   */
  function renderStockStatus(productId) {
    const stock = getProductStock(productId);
    const status = getStockStatus(stock);

    const stockStatusEl = document.getElementById('stockStatus');
    const stockTextEl = document.getElementById('stockText');

    if (stockStatusEl && stockTextEl) {
      // Remove all status classes
      stockStatusEl.classList.remove('in-stock', 'low-stock', 'out-of-stock');
      // Add current status class
      stockStatusEl.classList.add(status.className);
      // Update icon and text
      stockStatusEl.querySelector('.stock-icon').textContent = status.icon;
      stockTextEl.textContent = status.text;
    }

    // Update button states based on stock
    updateButtonStates(stock);
  }

  /**
   * Update Add to Cart and Buy Now button states
   * @param {number} stock - Current stock quantity
   */
  function updateButtonStates(stock) {
    const addCartBtn = document.getElementById('add-cart-btn');
    const buyNowBtn = document.getElementById('buy-now-btn');
    const increaseBtn = document.getElementById('increase-btn');
    const decreaseBtn = document.getElementById('decrease-btn');

    if (stock === 0) {
      // Disable all buttons when out of stock
      addCartBtn.disabled = true;
      buyNowBtn.disabled = true;
      increaseBtn.disabled = true;
      decreaseBtn.disabled = true;
    } else {
      // Enable buttons
      addCartBtn.disabled = false;
      buyNowBtn.disabled = false;
      decreaseBtn.disabled = quantity <= 1;
      increaseBtn.disabled = quantity >= stock;
    }
  }

  /**
   * Validate quantity against stock
   * @param {string} productId - Product identifier
   * @param {number} requestedQty - Requested quantity
   * @returns {boolean} True if valid
   */
  function validateQuantity(productId, requestedQty) {
    const stock = getProductStock(productId);
    if (requestedQty > stock) {
      showToast(t('stockWarning').replace('{count}', stock), true);
      return false;
    }
    return true;
  }

  // ========================================
  // CART MANAGEMENT FUNCTIONS
  // ========================================

  function getCart() {
    return JSON.parse(localStorage.getItem('cartItems')) || [];
  }

  function saveCart(cart) {
    localStorage.setItem('cartItems', JSON.stringify(cart));
    updateCartBadge();
  }

  function updateCartBadge() {
    const cart = getCart();
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    const badge = document.getElementById('cartBadge');
    if (badge) {
      badge.textContent = totalItems;
      if (totalItems > 0) {
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }
    }
  }

  function addToCart(product, qty) {
    const cart = getCart();
    const productId = product.brand + '_' + product.category;
    const existingIndex = cart.findIndex(item => item.id === productId);

    if (existingIndex !== -1) {
      cart[existingIndex].quantity += qty;
    } else {
      cart.push({
        id: productId,
        name: product.brand + ' ' + product.category,
        price: Number(product.price),
        quantity: qty,
        brand: product.brand,
        category: product.category
      });
    }

    saveCart(cart);
    showToast(t('itemAddedToCart'));
  }

  function showToast(message, isError = false) {
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    const toastIcon = toast.querySelector('.toast-icon');

    toastMessage.textContent = message;
    toastIcon.textContent = isError ? '‚úó' : '‚úì';

    if (isError) {
      toast.classList.add('error');
    } else {
      toast.classList.remove('error');
    }

    toast.classList.add('show');
    setTimeout(() => { toast.classList.remove('show'); }, 2500);
  }

  // ========================================
  // WISHLIST MANAGEMENT FUNCTIONS
  // ========================================

  /**
   * Get wishlist from localStorage
   * @returns {Array} Array of wishlist items
   */
  function getWishlist() {
    return JSON.parse(localStorage.getItem('wishlistItems')) || [];
  }

  /**
   * Save wishlist to localStorage
   * @param {Array} wishlist - Array of wishlist items
   */
  function saveWishlist(wishlist) {
    localStorage.setItem('wishlistItems', JSON.stringify(wishlist));
    updateWishlistBadge();
  }

  /**
   * Update wishlist badge count in navbar
   */
  function updateWishlistBadge() {
    const wishlist = getWishlist();
    const badge = document.getElementById('wishlistBadge');

    if (badge) {
      badge.textContent = wishlist.length;
      if (wishlist.length > 0) {
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }
    }
  }

  /**
   * Check if product is already in wishlist
   * @param {string} productId - Product identifier
   * @returns {boolean}
   */
  function isInWishlist(productId) {
    const wishlist = getWishlist();
    return wishlist.some(item => item.id === productId);
  }

  /**
   * Add product to wishlist
   * @param {Object} product - Product object
   */
  function addToWishlist(product) {
    const wishlist = getWishlist();
    const productId = product.brand + '_' + product.category;

    // Check if already in wishlist
    if (isInWishlist(productId)) {
      showToast(t('alreadyInWishlist'), true);
      return false;
    }

    // Add to wishlist
    wishlist.push({
      id: productId,
      name: product.brand + ' ' + product.category,
      price: Number(product.price),
      brand: product.brand,
      category: product.category
    });

    saveWishlist(wishlist);

    // Animate heart
    const heart = document.getElementById('wishlistHeart');
    if (heart) {
      heart.classList.add('animate');
      setTimeout(() => heart.classList.remove('animate'), 600);
    }

    // Update button state
    updateWishlistButtonState(productId);

    showToast(t('addedToWishlist'));
    return true;
  }

  /**
   * Remove product from wishlist
   * @param {string} productId - Product identifier
   */
  function removeFromWishlist(productId) {
    const wishlist = getWishlist();
    const updatedWishlist = wishlist.filter(item => item.id !== productId);
    saveWishlist(updatedWishlist);
    updateWishlistButtonState(productId);
    showToast(t('removedFromWishlist'));
  }

  /**
   * Toggle wishlist state for a product
   * @param {Object} product - Product object
   */
  function toggleWishlist(product) {
    const productId = product.brand + '_' + product.category;

    if (isInWishlist(productId)) {
      removeFromWishlist(productId);
    } else {
      addToWishlist(product);
    }
  }

  /**
   * Update wishlist button appearance based on state
   * @param {string} productId - Product identifier
   */
  function updateWishlistButtonState(productId) {
    const btn = document.getElementById('add-wishlist-btn');
    const heart = document.getElementById('wishlistHeart');
    const btnText = btn.querySelector('span[data-i18n]');

    if (isInWishlist(productId)) {
      btn.classList.add('in-wishlist');
      heart.textContent = '‚ù§Ô∏è';
      btnText.textContent = t('removeFromWishlist');
      btnText.setAttribute('data-i18n', 'removeFromWishlist');
    } else {
      btn.classList.remove('in-wishlist');
      heart.textContent = 'ü§ç';
      btnText.textContent = t('addToWishlist');
      btnText.setAttribute('data-i18n', 'addToWishlist');
    }
  }

  // ========================================
  // REVIEW STORAGE FUNCTIONS
  // ========================================

  /**
   * Get all reviews from localStorage
   * Returns object with productId as keys
   */
  function getAllReviews() {
    return JSON.parse(localStorage.getItem('productReviews')) || {};
  }

  /**
   * Save all reviews to localStorage
   */
  function saveAllReviews(reviews) {
    localStorage.setItem('productReviews', JSON.stringify(reviews));
  }

  /**
   * Get reviews for a specific product
   * @param {string} productId - Product identifier
   * @returns {array} Array of review objects
   */
  function getProductReviews(productId) {
    const allReviews = getAllReviews();
    return allReviews[productId] || [];
  }

  /**
   * Add a new review for a product
   * @param {string} productId - Product identifier
   * @param {number} rating - Star rating (1-5)
   * @param {string} comment - Review text
   */
  function addReview(productId, rating, comment) {
    const allReviews = getAllReviews();

    // Initialize array if product has no reviews
    if (!allReviews[productId]) {
      allReviews[productId] = [];
    }

    // Create new review object
    const newReview = {
      rating: rating,
      comment: comment,
      date: Date.now()
    };

    // Add to beginning of array (newest first)
    allReviews[productId].unshift(newReview);

    // Save to localStorage
    saveAllReviews(allReviews);

    return newReview;
  }

  // ========================================
  // AVERAGE RATING CALCULATION
  // ========================================

  /**
   * Calculate average rating for a product
   * @param {array} reviews - Array of review objects
   * @returns {object} { average, count }
   */
  function calculateAverageRating(reviews) {
    if (!reviews || reviews.length === 0) {
      return { average: 0, count: 0 };
    }

    const sum = reviews.reduce((total, review) => total + review.rating, 0);
    const average = sum / reviews.length;

    return {
      average: Math.round(average * 10) / 10, // Round to 1 decimal
      count: reviews.length
    };
  }

  // ========================================
  // RENDER FUNCTIONS
  // ========================================

  /**
   * Render average rating display
   */
  function renderAverageRating(reviews) {
    const { average, count } = calculateAverageRating(reviews);

    // Update number display
    document.getElementById('avgRatingNumber').textContent = average.toFixed(1);
    document.getElementById('reviewsCountNum').textContent = count;

    // Update star display
    const starsContainer = document.getElementById('avgStarsDisplay');
    let starsHtml = '';
    for (let i = 1; i <= 5; i++) {
      if (i <= Math.floor(average)) {
        starsHtml += '<span class="star filled">‚òÖ</span>';
      } else if (i - 0.5 <= average) {
        starsHtml += '<span class="star filled">‚òÖ</span>'; // Simplified: show filled for half
      } else {
        starsHtml += '<span class="star">‚òÖ</span>';
      }
    }
    starsContainer.innerHTML = starsHtml;
  }

  /**
   * Render single review card
   */
  function renderReviewCard(review, isNew = false) {
    const starsHtml = Array(5).fill(0).map((_, i) =>
      `<span class="star ${i < review.rating ? 'filled' : ''}">‚òÖ</span>`
    ).join('');

    return `
      <div class="review-card ${isNew ? 'new' : ''}">
        <div class="review-card-header">
          <div class="review-stars">${starsHtml}</div>
          <div class="review-date">${formatDate(review.date)}</div>
        </div>
        <div class="review-text">${review.comment}</div>
      </div>
    `;
  }

  /**
   * Render empty reviews state
   */
  function renderEmptyReviews() {
    return `
      <div class="empty-reviews">
        <div class="empty-reviews-icon">üìù</div>
        <div class="empty-reviews-title" data-i18n="noReviews">${t('noReviews')}</div>
        <div class="empty-reviews-text" data-i18n="beFirstReview">${t('beFirstReview')}</div>
      </div>
    `;
  }

  /**
   * Render all reviews for current product
   */
  function renderReviews(productId) {
    const reviews = getProductReviews(productId);
    const reviewsList = document.getElementById('reviewsList');
    const reviewsListCount = document.getElementById('reviewsListCount');

    // Update count in title
    reviewsListCount.textContent = `(${reviews.length})`;

    // Render reviews or empty state
    if (reviews.length === 0) {
      reviewsList.innerHTML = renderEmptyReviews();
    } else {
      reviewsList.innerHTML = reviews.map(review => renderReviewCard(review)).join('');
    }

    // Update average rating
    renderAverageRating(reviews);
  }

  // ========================================
  // FORM VALIDATION & SUBMISSION
  // ========================================

  /**
   * Get selected rating value
   */
  function getSelectedRating() {
    const selected = document.querySelector('input[name="rating"]:checked');
    return selected ? parseInt(selected.value) : 0;
  }

  /**
   * Clear rating selection
   */
  function clearRatingSelection() {
    const radios = document.querySelectorAll('input[name="rating"]');
    radios.forEach(radio => radio.checked = false);
  }

  /**
   * Validate and submit review
   */
  function handleReviewSubmit(productId) {
    const rating = getSelectedRating();
    const comment = document.getElementById('reviewTextarea').value.trim();
    const ratingError = document.getElementById('ratingError');
    const reviewError = document.getElementById('reviewError');

    // Reset errors
    ratingError.classList.remove('show');
    reviewError.classList.remove('show');

    let isValid = true;

    // Validate rating
    if (rating === 0) {
      ratingError.classList.add('show');
      isValid = false;
    }

    // Validate comment
    if (!comment) {
      reviewError.classList.add('show');
      isValid = false;
    }

    if (!isValid) return;

    // Add review
    addReview(productId, rating, comment);

    // Clear form
    clearRatingSelection();
    document.getElementById('reviewTextarea').value = '';

    // Re-render reviews
    renderReviews(productId);

    // Show success toast
    showToast(t('reviewSubmitted'));
  }

  // ========================================
  // QUANTITY LOGIC WITH STOCK VALIDATION
  // ========================================
  let quantity = 1;
  let currentProductId = null; // Will be set during initialization
  const qtyNumber = document.getElementById('qty-number');

  document.getElementById('decrease-btn').addEventListener('click', () => {
    if (quantity > 1) {
      quantity--;
      qtyNumber.textContent = quantity;
      // Update button states based on new quantity
      const stock = getProductStock(currentProductId);
      updateButtonStates(stock);
    }
  });

  document.getElementById('increase-btn').addEventListener('click', () => {
    const stock = getProductStock(currentProductId);

    // Check if we can increase quantity
    if (quantity < stock) {
      quantity++;
      qtyNumber.textContent = quantity;
      // Update button states based on new quantity
      updateButtonStates(stock);
    } else {
      // Show warning if trying to exceed stock
      showToast(t('stockWarning').replace('{count}', stock), true);
    }
  });

  // ========================================
  // INITIALIZATION
  // ========================================
  window.onload = function() {
    const brand = getBrandFromURL();
    const product = getProductByBrand(brand) || products[0];
    const productId = getProductId(product);
    const wishlistProductId = product.brand + '_' + product.category;

    // Set current product ID for stock validation
    currentProductId = wishlistProductId;

    // Initialize stock data
    initializeStock();

    // Render product details
    renderProductDetail(product);

    // Render stock status
    renderStockStatus(currentProductId);

    // Initialize cart badge
    updateCartBadge();

    // Initialize wishlist badge and button state
    updateWishlistBadge();
    updateWishlistButtonState(wishlistProductId);

    // Render reviews
    renderReviews(productId);

    // Add to Cart button with stock validation
    document.getElementById('add-cart-btn').onclick = () => {
      const stock = getProductStock(currentProductId);

      // Validate stock before adding
      if (stock === 0) {
        showToast(t('outOfStock'), true);
        return;
      }

      if (quantity > stock) {
        showToast(t('insufficientStock'), true);
        return;
      }

      addToCart(product, quantity);
    };

    // Buy Now button with stock validation
    document.getElementById('buy-now-btn').onclick = () => {
      const stock = getProductStock(currentProductId);

      // Validate stock before buying
      if (stock === 0) {
        showToast(t('outOfStock'), true);
        return;
      }

      if (quantity > stock) {
        showToast(t('insufficientStock'), true);
        return;
      }

      localStorage.setItem('checkoutProduct', JSON.stringify({
        id: currentProductId,
        name: product.brand + ' ' + product.category,
        price: Number(product.price),
        quantity: quantity
      }));
      localStorage.removeItem('checkoutFromCart');
      window.location.href = 'checkout.html';
    };

    // Add to Wishlist button
    document.getElementById('add-wishlist-btn').onclick = () => {
      toggleWishlist(product);
    };

    // Submit Review button
    document.getElementById('submitReviewBtn').onclick = () => {
      handleReviewSubmit(productId);
    };

    // Re-render on language change
    window.addEventListener('languageChanged', function() {
      renderProductDetail(product);
      renderReviews(productId);
      updateWishlistButtonState(wishlistProductId);
      renderStockStatus(currentProductId);
    });
  };

  // ========================================
  // DARK MODE SYSTEM
  // ========================================
  function getCurrentTheme() {
    return localStorage.getItem('themeMode') || 'light';
  }
  function setTheme(theme) {
    localStorage.setItem('themeMode', theme);
  }
  function applyTheme(theme) {
    if (theme === 'dark') {
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
    }
  }
  function toggleTheme() {
    const current = getCurrentTheme();
    const newTheme = current === 'dark' ? 'light' : 'dark';
    setTheme(newTheme);
    applyTheme(newTheme);
  }
  function initDarkMode() {
    const savedTheme = getCurrentTheme();
    applyTheme(savedTheme);
    const toggle = document.getElementById('themeToggle');
    if (toggle) {
      toggle.addEventListener('click', toggleTheme);
    }
  }
  initDarkMode();

  // ========================================
  // ADMIN SYNC - LISTEN FOR PRODUCT CHANGES
  // ========================================
  /**
   * Listen for localStorage changes from admin panel
   * Updates product data and stock in real-time
   */
  window.addEventListener('storage', function(e) {
    if (e.key === 'adminProducts' || e.key === 'productStock') {
      // Refresh products from localStorage
      products = getAllProducts();
      // Re-render stock status if applicable
      if (currentProductId) {
        renderStockStatus(currentProductId);
      }
    }
  });
  </script>
</body>
</html>
